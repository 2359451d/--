# MySQL Study

study note

- [MySQL Study](#mysql-study)
  - [çº¦æŸ Constraint](#çº¦æŸ-constraint)
    - [éç©ºçº¦æŸ:not null](#éç©ºçº¦æŸnot-null)
    - [å”¯ä¸€çº¦æŸï¼šunique](#å”¯ä¸€çº¦æŸunique)
    - [ä¸»é”®çº¦æŸï¼šprimary key](#ä¸»é”®çº¦æŸprimary-key)
      - [åˆ—çº§çº¦æŸï¼šå®šä¹‰ä¸»é”®](#åˆ—çº§çº¦æŸå®šä¹‰ä¸»é”®)
      - [è¡¨çº§çº¦æŸï¼šå®šä¹‰ä¸»é”®](#è¡¨çº§çº¦æŸå®šä¹‰ä¸»é”®)
      - [å¤åˆä¸»é”®ä½¿ç”¨](#å¤åˆä¸»é”®ä½¿ç”¨)
      - [ä¸»é”®ç›¸å…³çš„æœ¯è¯­](#ä¸»é”®ç›¸å…³çš„æœ¯è¯­)
      - [ä¸»é”®æœ‰ä»€ä¹ˆç”¨](#ä¸»é”®æœ‰ä»€ä¹ˆç”¨)
      - [ä¸»é”®åˆ†ç±»](#ä¸»é”®åˆ†ç±»)
      - [(*)mysqlæä¾›PKè‡ªå¢: auto_increment](#mysqlæä¾›pkè‡ªå¢-auto_increment)
    - [å¤–é”®çº¦æŸï¼šforeign key](#å¤–é”®çº¦æŸforeign-key)
      - [FKå¯ä»¥ä¸ºnull](#fkå¯ä»¥ä¸ºnull)
      - [FKå¯ä»¥ä¸ä¸ºPKï¼Œä½†å¿…é¡»å”¯ä¸€](#fkå¯ä»¥ä¸ä¸ºpkä½†å¿…é¡»å”¯ä¸€)
  - [å­˜å‚¨å¼•æ“(äº†è§£)](#å­˜å‚¨å¼•æ“äº†è§£)
    - [æŸ¥çœ‹å½“å‰æ”¯æŒçš„å­˜å‚¨å¼•æ“](#æŸ¥çœ‹å½“å‰æ”¯æŒçš„å­˜å‚¨å¼•æ“)
    - [MyISAM](#myisam)
    - [InnoDB](#innodb)
    - [MEMORY(\HEPA)](#memoryhepa)
  - [äº‹åŠ¡ï¼šTransaction](#äº‹åŠ¡transaction)
    - [äº‹åŠ¡ç‰¹æ€§](#äº‹åŠ¡ç‰¹æ€§)
      - [äº‹åŠ¡éš”ç¦»æ€§](#äº‹åŠ¡éš”ç¦»æ€§)
    - [æ¼”ç¤ºäº‹åŠ¡](#æ¼”ç¤ºäº‹åŠ¡)
      - [å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤: start transaction](#å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤-start-transaction)
      - [è®¾ç½®&æŸ¥çœ‹ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«](#è®¾ç½®æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«)
      - [æ¼”ç¤ºï¼šread committed](#æ¼”ç¤ºread-committed)
      - [æ¼”ç¤ºï¼šrepetable read](#æ¼”ç¤ºrepetable-read)
      - [æ¼”ç¤ºï¼šserializable](#æ¼”ç¤ºserializable)
  - [explainï¼šæŸ¥çœ‹sqlè¯­å¥æ‰§è¡Œè®¡åˆ’](#explainæŸ¥çœ‹sqlè¯­å¥æ‰§è¡Œè®¡åˆ’)
  - [ç´¢å¼•ï¼šindex](#ç´¢å¼•index)
    - [åˆ›å»º & åˆ é™¤ç´¢å¼•](#åˆ›å»º--åˆ é™¤ç´¢å¼•)
    - [ä¸ºä»€ä¹ˆç´¢å¼•æ•ˆç‡é«˜](#ä¸ºä»€ä¹ˆç´¢å¼•æ•ˆç‡é«˜)
    - [ä½•æ—¶è€ƒè™‘ç»™å­—æ®µæ·»åŠ ç´¢å¼•](#ä½•æ—¶è€ƒè™‘ç»™å­—æ®µæ·»åŠ ç´¢å¼•)
    - [ç´¢å¼•åº•å±‚åŸç†](#ç´¢å¼•åº•å±‚åŸç†)
    - [ç´¢å¼•åˆ†ç±»](#ç´¢å¼•åˆ†ç±»)
  - [View: è§†å›¾](#view-è§†å›¾)
    - [åˆ›å»º & åˆ é™¤è§†å›¾](#åˆ›å»º--åˆ é™¤è§†å›¾)
    - [é¢å‘è§†å›¾æ“ä½œ](#é¢å‘è§†å›¾æ“ä½œ)
    - [è§†å›¾ä½œç”¨ï¼ˆseldom usedï¼‰](#è§†å›¾ä½œç”¨seldom-used)

## çº¦æŸ Constraint

ä»€ä¹ˆæ˜¯çº¦æŸ?

- åˆ›å»ºè¡¨çš„æ—¶å€™,å¯ä»¥ç»™<font color="red">è¡¨å­—æ®µæ·»åŠ ç›¸åº”çº¦æŸ</font>
  - **ä¸ºäº†ä¿è¯è¡¨ä¸­æ•°æ®çš„åˆæ³•æ€§,æœ‰æ•ˆæ€§,å®Œæ•´æ€§**

å¸¸è§çº¦æŸ?

- éç©ºçº¦æŸ`not null`
  - çº¦æŸçš„å­—æ®µä¸èƒ½ä¸º`null`
- **å”¯ä¸€çº¦æŸ`unique`**
  - çº¦æŸçš„å­—æ®µä¸èƒ½é‡å¤
- **ä¸»é”®çº¦æŸ`pk`**
  - çº¦æŸçš„å­—æ®µæ—¢ä¸èƒ½ä¸º`null`,ä¹Ÿä¸èƒ½é‡å¤
- **å¤–é”®çº¦æŸ`fk`**
- æ£€æŸ¥çº¦æŸ`check`
  - æ³¨æ„Oracleæœ‰check'çº¦æŸ,**mysqlæ²¡æœ‰**

### éç©ºçº¦æŸ:not null

ğŸŠ not null**åªæœ‰åˆ—çº§çº¦æŸï¼Œæ²¡æœ‰è¡¨çº§çº¦æŸ**

```mysql
drop table if exists t_user;
create table t_user(
    id int,
    username varchar(255) not null,
    password varchar(255)
);

<!-- æ’å…¥æ•°æ® -->
insert into t_user(id,username,password) values(1,'123');
```

### å”¯ä¸€çº¦æŸï¼šunique

- å”¯ä¸€çº¦æŸä¿®é¥°çš„å­—æ®µï¼Œ
  - **æœ‰å”¯ä¸€æ€§ï¼Œä¸èƒ½é‡å¤**
  - ä½†**å¯ä»¥ä¸º`null`**

![](/static/2020-09-16-14-29-25.png)

ç»™ä¸¤ä¸ªåˆ—&å¤šä¸ªåˆ—**è”åˆæ·»åŠ 1ä¸ªuniqueã€è¡¨çº§çº¦æŸã€‘**

- ä¸å¤šä¸ª**å­—æ®µå•ç‹¬æ·»åŠ uniqueã€åˆ—çº§çº¦æŸã€‘**ä¸åŒ

![](/static/2020-09-16-14-31-34.png)
![](/static/2020-09-16-14-34-02.png)

### ä¸»é”®çº¦æŸï¼šprimary key

ğŸŠ ç‰¹ç‚¹

- ä¸èƒ½ä¸ºç©º
- ä¸èƒ½é‡å¤

#### åˆ—çº§çº¦æŸï¼šå®šä¹‰ä¸»é”®

æ€ä¹ˆç»™ä¸€å¼ è¡¨æ·»åŠ ä¸»é”®çº¦æŸï¼Ÿï¼ˆ**åˆ—çº§çº¦æŸ**ï¼‰

```mysql
drop table if exists t_user;
create table t_user(
  id int primary key,
  username varchar(255),
  email varchar(255)
);

insert into t_user(id, username, email) values(1,'zs','zs@123.com');
insert into t_user(id, username, email) values(1,'ls','ls@123.com');// not work
insert into t_user(username, email) values('ww','ww@123.com');// not work
select * from t_user;
```

#### è¡¨çº§çº¦æŸï¼šå®šä¹‰ä¸»é”®

```mysql
drop table if exists t_user;
create table t_user(
  id int,
  username varchar(255),
  primary key(id)
);

insert int t_user(id,username) values(1,'zs');
```

#### å¤åˆä¸»é”®ä½¿ç”¨

ä¸éœ€è¦æŒæ¡

- ä¸¤ä¸ªå­—æ®µè”åˆèµ·æ¥ç»„æˆä¸»é”®ï¼Œè”åˆä¸»é”®ä¸èƒ½é‡å¤

```mysql
drop table if exists t_user;
create table t_user(
  id int,
  username varchar(255),
  primary key(iï¼Œusername)
);

insert int t_user(id,username) values(1,'zs');
```

#### ä¸»é”®ç›¸å…³çš„æœ¯è¯­

ä¸»é”®çº¦æŸ

- `primary key`

ä¸»é”®å­—æ®µ

- idå­—æ®µæ·»åŠ pkåï¼Œidå«åš**ä¸»é”®å­—æ®µ**

ä¸»é”®å€¼

- **idå­—æ®µä¸­æ¯ä¸ªå€¼éƒ½æ˜¯ä¸»é”®å€¼**

#### ä¸»é”®æœ‰ä»€ä¹ˆç”¨

è¡¨çš„è®¾è®¡3èŒƒå¼ä¸­æœ‰è¦æ±‚

- **ä»»ä½•ä¸€å¼ è¡¨éƒ½åº”è¯¥æœ‰ä¸»é”®**

ğŸŠ ä¸»é”®çš„ä½œç”¨

- ä¸»é”®å€¼æ˜¯**è¿™è¡Œè®°å½•åœ¨è¿™ç§è¡¨ä¸­çš„å”¯ä¸€æ ‡è¯†**

#### ä¸»é”®åˆ†ç±»

ğŸŠ æ ¹æ®**ä¸»é”®å­—æ®µçš„å­—æ®µæ•°é‡**æ¥åˆ’åˆ†

- **å•ä¸€ä¸»é”®**
- å¤åˆä¸»é”®(å¼±å®ä½“)
  - **å¤šä¸ªå­—æ®µè”åˆç»„æˆä¸€ä¸ªPK**
  - ä¸å»ºè®®ä½¿ç”¨ï¼Œ<font color="blue">è¿èƒŒä¸‰èŒƒå¼</font>

ğŸŠ æ ¹æ®**ä¸»é”®æ€§è´¨**åˆ’åˆ†

- è‡ªç„¶ä¸»é”®
  - <font color="red">ä¸»é”®å€¼æœ€å¥½æ˜¯ä¸€ä¸ªä¸ä¸šåŠ¡æ— å…³çš„è‡ªç„¶æ•°</font>
- ä¸šåŠ¡ä¸»é”®
  - **ä¸»é”®å€¼å’Œç³»ç»Ÿä¸šåŠ¡æŒ‚é’©**ï¼Œå¦‚é“¶è¡Œå¡å·åšPK,èº«ä»½è¯å·åšPKï¼Œ<font color="blue">ä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºä»¥åä¸šåŠ¡ä¸€æ—¦æ”¹å˜ï¼Œä¸»é”®å€¼å¯èƒ½ä¹Ÿéœ€è¦æ”¹å˜ï¼ˆæœ‰æ—¶å€™å¯èƒ½æ²¡åŠæ³•æ”¹å˜ï¼‰</font>

ğŸ¬ <font color="red">ä¸€å¼ è¡¨çš„æ¯æ¡è®°å½•çš„ä¸»é”®çº¦æŸåªèƒ½ä¸ºä¸€ä¸ª</font>

#### (*)mysqlæä¾›PKè‡ªå¢: auto_increment

`auto_increment`

- è¢«ä¿®é¥°çš„å­—æ®µ**è‡ªåŠ¨ç»´æŠ¤ä¸€ä¸ªè‡ªå¢æ•°å­—**
  - `1`èµ·å§‹ï¼Œ`1`é€’å¢

ğŸŠ oracleä¹Ÿæä¾›ä¸€ä¸ªè‡ªå¢æœºåˆ¶

- **åºåˆ—å¯¹è±¡sequence**

![](/static/2020-09-16-16-51-31.png)

```mysql
drop table if exists t_user;
create table t_user(
  id int primary key auto_increment,
  username varchar(255)
);
insert into t_user(username) values('a');
insert into t_user(username) values('a');
insert into t_user(username) values('a');
select * from t_user;
```

### å¤–é”®çº¦æŸï¼šforeign key

å¤–é”®çº¦æŸç›¸å…³æœ¯è¯­

- å¤–é”®çº¦æŸ
  - FK
- å¤–é”®å­—æ®µ
- å¤–é”®å€¼

ğŸŠ ä¾‹å­

![](/static/2020-09-16-17-09-16.png)

- å…¶ä¸­ä¸€å¼ è¡¨ä½œä¸ºçˆ¶è¡¨ï¼Œå¼•ç”¨å…¶ä»–è¡¨PKä½œä¸ºFKçš„è¡¨ä½œä¸ºå­è¡¨
  - å­ï¼šstudentï¼Œçˆ¶ï¼šclass
- åˆ é™¤æ•°æ®
  - å…ˆåˆ å­ï¼Œå†åˆ çˆ¶
- æ·»åŠ /åˆ›å»ºæ•°æ®
  - å…ˆçˆ¶ï¼Œå†å­

```mysql
drop table if exists t_student;
drop table if exists t_class;

create table t_class(
  cno int,
  cname varchar(255),
  primary key(cno)
);

create table t_student(
  sno int,
  sname varchar(255),
  classno int,
  foreign key(classno) references t_class(cno)
)
```

#### FKå¯ä»¥ä¸ºnull

#### FKå¯ä»¥ä¸ä¸ºPKï¼Œä½†å¿…é¡»å”¯ä¸€

ä¸€èˆ¬æƒ…å†µéƒ½é€‰PKä½œä¸ºFK

## å­˜å‚¨å¼•æ“(äº†è§£)

å³ï¼Œè¡¨çš„å­˜å‚¨æ–¹å¼

- **ä¸åŒå¼•æ“è¡¨çš„å­˜å‚¨æ–¹å¼ä¸åŒ**
  - <font color="blue">åªåœ¨mysqlä¸­ï¼Œï¼ˆoracleæœ‰å¯¹åº”æœºåˆ¶ï¼Œä½†ä¸å«å­˜å‚¨å¼•æ“ï¼Œç›´æ¥å«è¡¨çš„å­˜å‚¨æ–¹å¼ï¼‰</font>
- mysqlæ”¯æŒå¾ˆå¤šå­˜å‚¨å¼•æ“ï¼Œæ¯æ¡å¼•æ“å¯¹åº”ä¸€ç§ä¸åŒå­˜å‚¨æ–¹å¼
  - <font color="green">æ¯ä¸ªå­˜å‚¨å¼•æ“æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œéœ€è¦åœ¨åˆé€‚çš„æ—¶æœºé€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“</font>
- mysql
  - **é»˜è®¤å­˜å‚¨å¼•æ“ï¼š`InnoDB`**
  - **é»˜è®¤å­—ç¬¦é›†`utf8`ï¼ˆé…ç½®åï¼‰**

ğŸŠ å®Œæ•´çš„å»ºè¡¨è¯­å¥

- <font color="red">å»ºè¡¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šå­˜å‚¨å¼•æ“&å­—ç¬¦é›†</font>

```mysql
create table 't_x'(
  'id' int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8
```

### æŸ¥çœ‹å½“å‰æ”¯æŒçš„å­˜å‚¨å¼•æ“

`show engines \G`

- mysql 5.5.36æ”¯æŒ**9ä¸ªå­˜å‚¨å¼•æ“**

### MyISAM

ğŸŠ ç‰¹ç‚¹

![](/static/2020-09-16-21-08-25.png)

- **æœ€å¸¸ç”¨çš„å¼•æ“ï¼Œä½†ä¸æ˜¯é»˜è®¤çš„**
- **ä¸æ”¯æŒäº‹åŠ¡**
- ä»¥**3ç§æ–‡ä»¶**è¡¨ç¤ºæ¯ä¸ªè¡¨
  - æ ¼å¼æ–‡ä»¶ - å­˜å‚¨**è¡¨ç»“æ„å®šä¹‰**`mytable.frm`
  - æ•°æ®æ–‡ä»¶ - å­˜å‚¨**è¡¨è¡Œçš„å†…å®¹**`mytable.MYD`
  - ç´¢å¼•æ–‡ä»¶ - å­˜å‚¨**è¡¨ä¸Šç´¢å¼•**`mytable.MYI`

ğŸ¬ ä¼˜ç‚¹

- å¯**å‹ç¼©ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´**
- å¯**è½¬æ¢ä¸ºåªè¯»è¡¨ï¼Œæé«˜æ£€ç´¢æ•ˆç‡**

ğŸ¬ ç¼ºç‚¹

- **ä¸æ”¯æŒäº‹åŠ¡**

```cmd
      Engine: MyISAM
     Support: YES
     Comment: MyISAM storage engine
Transactions: NO
          XA: NO
  Savepoints: NO
```

### InnoDB

![](/static/2020-09-16-21-12-44.png)

- mysql**ç¼ºçœå¼•æ“**
- **è¡¨ç»“æ„** - `...frm`æ–‡ä»¶ä¸­
- **è¡¨æ•°æ®** - `tablespace`è¡¨ç©ºé—´ï¼ˆé€»è¾‘æ¦‚å¿µï¼‰ä¸­
  - **æ— æ³•è¢«å‹ç¼©ï¼Œæ— æ³•è½¬æ¢ä¸ºåªè¯»æ–‡ä»¶**
- <font color="red">mysqlå´©æºƒåï¼ŒinnoDBæä¾›è‡ªåŠ¨æ¢å¤</font>
- <font color="blue">æ”¯æŒçº§è”åˆ é™¤&çº§è”æ›´æ–°</font>

ğŸ¬ ä¼˜ç‚¹

- **æ”¯æŒäº‹åŠ¡**
- **æ”¯æŒè¡Œçº§é”**
  - <font color="red">æœ€å®‰å…¨ï¼Œæ•°æ®å®‰å…¨å¾—åˆ°ä¿éšœ</font>
- **æ”¯æŒå¤–é”®**

```cmd
      Engine: InnoDB
     Support: DEFAULT
     Comment: Supports transactions, row-level locking, and foreign keys
Transactions: YES
          XA: YES
  Savepoints: YES
```

### MEMORY(\HEPA)

```cmd
      Engine: MEMORY
     Support: YES
     Comment: Hash based, stored in memory, useful for temporary tables
Transactions: NO
          XA: NO
  Savepoints: NO
```

ğŸ¬ ä¼˜ç‚¹

- **æŸ¥è¯¢é€Ÿåº¦æœ€å¿«**

ğŸ¬ ç¼ºç‚¹

- **ä¸æ”¯æŒäº‹åŠ¡**
- **æ•°æ®å®¹æ˜“ä¸¢å¤±**
  - å› ä¸ºæ‰€æœ‰**æ•°æ®&ç´¢å¼•éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­**

## äº‹åŠ¡ï¼šTransaction

ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼Ÿ

- **å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å•å…ƒ**ï¼Œä¸å¯å†åˆ†
  - æ¯”å¦‚é“¶è¡Œè´¦æˆ·è½¬è´¦ï¼Œéœ€è¦2æ¡updateè¯­å¥ï¼Œ**å¿…é¡»åŒæ—¶æˆåŠŸï¼Œæˆ–è€…åŒæ—¶å¤±è´¥ï¼Œéœ€è¦ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æœºåˆ¶**
- <font color="red">ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œå®‰å…¨æ€§</font>

ğŸŠ **äº‹åŠ¡åªè·Ÿ`DML`è¯­å¥æœ‰å…³**ï¼Œå› ä¸ºè·Ÿæ•°æ®ç›¸å…³

- insert
- delete
- update

### äº‹åŠ¡ç‰¹æ€§

äº‹åŠ¡åŒ…æ‹¬å››å¤§ç‰¹æ€§ï¼šACID

- A - **åŸå­æ€§**
  - äº‹åŠ¡ï¼šæœ€å°çš„å·¥ä½œå•å…ƒï¼Œä¸å¯å†åˆ†
- C - **ä¸€è‡´æ€§**
  - äº‹åŠ¡å¿…é¡»**ä¿è¯å¤šæ¡DMLè¯­å¥åŒæ—¶æˆåŠŸ&åŒæ—¶å¤±è´¥**
- I - **éš”ç¦»æ€§**
  - **äº‹åŠ¡A & äº‹åŠ¡Bä¹‹é—´æœ‰éš”ç¦»**
- D - **æŒä¹…æ€§**
  - æœ€ç»ˆæ•°æ®**å¿…é¡»æŒä¹…åŒ–åˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­**ï¼Œäº‹åŠ¡æ‰ç®—æˆåŠŸç»“æŸ

#### äº‹åŠ¡éš”ç¦»æ€§

å­˜åœ¨éš”ç¦»çº§åˆ«ï¼Œ**ç†è®ºä¸Š**çº§åˆ«åŒ…æ‹¬4ä¸ª

1. **è¯»æœªæäº¤ read uncommitted**
   1. å¯¹æ–¹äº‹åŠ¡æœªæäº¤ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥è¯»å–åˆ°å¯¹æ–¹æœªæäº¤çš„æ•°æ®
   2. é—®é¢˜ï¼šå­˜åœ¨**è„è¯»ç°è±¡**
2. **è¯»å·²æäº¤ read committed**
   1. å¯¹æ–¹äº‹åŠ¡æäº¤åæˆ‘æ–¹è¯»å–åˆ°
   2. **è§£å†³ï¼šè„è¯»é—®é¢˜**
   3. é—®é¢˜ï¼š**ä¸å¯é‡å¤è¯»ï¼ˆä¿®æ”¹åå†æäº¤ï¼Œæ— æ³•è¯»åˆ°åŸæ¥æœªä¿®æ”¹çš„æ•°æ®ï¼‰**
   4. <font color="red">ã€oracleé»˜è®¤éš”ç¦»çº§åˆ«ã€‘ç±»ä¼¼æ™®é€šsynchronizedï¼Œå°‘äº†CASçš„ä¸€å±‚éªŒè¯-æ›´æ–°æœºåˆ¶</font>
3. **å¯é‡å¤è¯» repeatable read**
   1. éš”ç¦»ï¼Œ**è§£å†³ï¼šä¸å¯é‡å¤è¯»é—®é¢˜**
   2. é—®é¢˜ï¼š**å¹»è¯»(è¿™è¾¹åˆ äº†ï¼Œé‚£è¾¹è¿˜æœªåˆ )**
   3. <font color="red">ã€mysqlé»˜è®¤éš”ç¦»çº§åˆ«ã€‘</font>
4. **åºåˆ—åŒ–è¯»/ä¸²è¡ŒåŒ–è¯» sequential read**
   1. **è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¸å­˜åœ¨é”å®‰å…¨é—®é¢˜**
   2. <font color="red">æ•ˆç‡ä½ï¼Œéœ€è¦äº‹åŠ¡æ’é˜Ÿ</font>

ğŸ¬ mysqlé»˜è®¤éš”ç¦»çº§åˆ«ï¼š**å¯é‡å¤è¯»**

### æ¼”ç¤ºäº‹åŠ¡

ğŸŠ mysqläº‹åŠ¡é»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨æäº¤

- è‡ªåŠ¨æäº¤ï¼š**åªè¦æ‰§è¡Œä»»æ„ä¸€æ¡DMLè¯­å¥åˆ™æäº¤ä¸€æ¬¡**

#### å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤: start transaction

ğŸ¬ æ€ä¹ˆ**å…³é—­è‡ªåŠ¨æäº¤**ï¼Ÿ

- `start transaction;`
- ä¸å…³é—­ï¼Œæ¯æ‰§è¡Œä¸€æ¡DMLå°±æäº¤æ›´æ–°ä¸€æ¬¡äº‹åŠ¡

![](/static/2020-09-16-22-29-54.png)

#### è®¾ç½®&æŸ¥çœ‹ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«

è®¾ç½®äº‹åŠ¡å…¨å±€éš”ç¦»çº§åˆ«

`set global transaction isolation level <isolation_level>;`

æŸ¥çœ‹äº‹åŠ¡å…¨å±€éš”ç¦»çº§åˆ«

`select @@global.tx isolation;`5.7
`select @@tx_isolation;`8.0

#### æ¼”ç¤ºï¼šread committed

1. è®¾ç½®å…¨å±€éš”ç¦»çº§åˆ«ï¼šread committed
   1. ![](/static/2020-09-16-22-42-13.png)
2. äº‹åŠ¡Bæ‰§è¡Œï¼Œæœªæäº¤
   1. ![](/static/2020-09-16-22-45-10.png)
3. è¯»ï¼Œå·²æäº¤ï¼ˆå¯è¯»åˆ°æœ€æ–°æ•°æ®ï¼‰
   1. ![](/static/2020-09-16-22-46-31.png)

#### æ¼”ç¤ºï¼šrepetable read

![](/static/2020-09-16-22-48-55.png)

- äº‹åŠ¡Bï¼Œæ€ä¹ˆå¢åˆ æ”¹DMLæ•°æ®ï¼Œ**äº‹åŠ¡Aæ°¸è¿œè¯»çš„ç¡¬ç›˜å¤‡ä»½æ•°æ®ï¼ˆå¹»è¯»ï¼‰**

#### æ¼”ç¤ºï¼šserializable

è®¾ç½®å…¨å±€éš”ç¦»çº§åˆ« - åºåˆ—åŒ–ï¼ˆä¸²è¡Œï¼‰è¯»: `set global transaction isolation level serializable;`

![](/static/2020-09-16-22-58-24.png)
![](/static/2020-09-16-22-58-59.png)

- éœ€è¦**é˜»å¡æ’é˜Ÿ**ï¼Œæ•ˆç‡ä½ï¼Œ**ä½†å®‰å…¨**

## explainï¼šæŸ¥çœ‹sqlè¯­å¥æ‰§è¡Œè®¡åˆ’

`explain sql`

![](/static/2020-09-17-00-13-49.png)

## ç´¢å¼•ï¼šindex

ğŸ¬ æ³¨æ„

- <font color="red">ä¸»é”®&å…·æœ‰uniqueçº¦æŸçš„å­—æ®µä¼šè‡ªåŠ¨æ·»åŠ ç´¢å¼•</font>
  - **æ ¹æ®PKæŸ¥è¯¢æ•ˆç‡è¾ƒé«˜ï¼Œå°½é‡æ ¹æ®PKæ£€ç´¢**
- <font color="blue">ä½¿ç”¨æ¨¡ç³ŠæŸ¥è¯¢ç´¢å¼•å¯èƒ½ä¼šå¤±æ•ˆï¼Œå¦‚`%A%`ç¬¬ä¸€ä¸ªé€šé…ç¬¦ä½¿ç”¨`%`ï¼Œæ•ˆç‡ä½</font>

ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ

- ç±»ä¼¼ç›®å½•ï¼Œé€šè¿‡ç´¢å¼•å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å¯¹åº”èµ„æº
- ä¸¤ç§æ£€ç´¢æ–¹å¼
  - **å…¨è¡¨æ‰«æ**
  - **æ ¹æ®ç´¢å¼•æ£€ç´¢ï¼ˆæ•ˆç‡é«˜ï¼‰**

### åˆ›å»º & åˆ é™¤ç´¢å¼•

ğŸŠ **æ·»åŠ ç´¢å¼•ç»™å­—æ®µ**

`create index <index_name> on <t_name>(field);`

- ç»™salå­—æ®µæ·»åŠ ç´¢å¼•
  - **`create index emp_sal_index on emp(sal);`**
- `select ename,sal from emp where ename='SMITH';`
  - æ— ç´¢å¼•æ—¶ï¼Œä¼š**æ‰«æå…¨è¡¨ï¼Œenameæ‰€æœ‰çš„å€¼**
  - **enameæ·»åŠ ç´¢å¼•æ—¶**ï¼Œä¼š**æ ¹æ®ç´¢å¼•æ‰«æï¼Œå¿«é€Ÿå®šä½**

ğŸŠ **åˆ é™¤ç´¢å¼•**

`drop index <index_name> on t_name;`

### ä¸ºä»€ä¹ˆç´¢å¼•æ•ˆç‡é«˜

ğŸŠ ä¸ºä»€ä¹ˆç´¢å¼•æé«˜æ£€ç´¢æ•ˆç‡ï¼Ÿ

- åŸç†ï¼šç¼©å°æ‰«æèŒƒå›´

ğŸ¬ ä¸èƒ½ä¹±æ·»åŠ ç´¢å¼•

- <font color="red">ç´¢å¼•ä¹Ÿæ˜¯æ•°æ®åº“ä¸­çš„å¯¹è±¡ï¼Œéœ€è¦ä¸æ–­ç»´æŠ¤ï¼Œæœ‰ç»´æŠ¤æˆæœ¬</font>
- æ¯”å¦‚ï¼Œè¡¨ä¸­æ•°æ®ç»å¸¸è¢«ä¿®æ”¹ï¼Œä¸é€‚åˆæ·»åŠ ç´¢å¼•
  - **å› ä¸ºæ•°æ®ä¸€æ—¦ä¿®æ”¹ï¼Œç´¢å¼•éœ€è¦é‡æ–°æ’åºç»´æŠ¤**

### ä½•æ—¶è€ƒè™‘ç»™å­—æ®µæ·»åŠ ç´¢å¼•

ğŸŠ æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ç»™å­—æ®µæ·»åŠ ç´¢å¼•ï¼Ÿ

- **æ•°æ®é‡åºå¤§**
  - æ ¹æ®å®¢æˆ·éœ€æ±‚
- **å­—æ®µå¾ˆå°‘æœ‰DMLæ“ä½œ**
  - å› ä¸ºå­—æ®µè¿›è¡ŒDMLï¼Œç´¢å¼•ä¹Ÿéœ€è¦ç»´æŠ¤
- **å­—æ®µç»å¸¸å‡ºç°åœ¨whereå­å¥ä¸­**

### ç´¢å¼•åº•å±‚åŸç†

ä½¿ç”¨Bæ ‘

![](/static/2020-09-17-00-55-18.png)

- é€šè¿‡Bæ ‘**ç¼©å°æ‰«æèŒƒå›´ï¼Œæé«˜æ£€ç´¢æ•ˆç‡**
- æ¯ä¸ªç´¢å¼•å¯¹è±¡å®è´¨å°±æ˜¯ä¸€ä¸ªæ ‘å¯¹è±¡
  - **å­˜æ”¾æ•°æ®&å¯¹åº”ç‰©ç†åœ°å€**
- <font color="red">ç´¢å¼•å¯¹è±¡åº•å±‚ä¼šè‡ªåŠ¨æ’åº&åˆ†åŒº</font>ï¼Œç´¢å¼•å¯¹è±¡æ ¹æ®å­˜å‚¨å¼•æ“çš„ä¸åŒï¼Œ**å­˜æ”¾åœ¨å†…å­˜/ç¡¬ç›˜**
  - ä¸€æ—¦**é€šè¿‡ç´¢å¼•å¯¹è±¡ï¼Œè·å–ã€æ•°æ®å…³è”çš„ç‰©ç†åœ°å€ã€‘**åï¼Œæ›¿æ¢DQL whereæ¡ä»¶**ç›´æ¥å®šä½åŸè¡¨ä¸­æ•°æ®**ï¼Œæ•ˆç‡æœ€é«˜

### ç´¢å¼•åˆ†ç±»

- å•ä¸€ç´¢å¼•
  - **å•ä¸ªå­—æ®µ**æ·»åŠ ç´¢å¼•
- å¤åˆç´¢å¼•
  - **å¤šä¸ªå­—æ®µè”åˆ**æ·»åŠ 1ä¸ªç´¢å¼•
- ä¸»é”®ç´¢å¼•
  - **PK**ä¼š**è‡ªåŠ¨æ·»åŠ **ç´¢å¼•
- å”¯ä¸€ç´¢å¼•
  - **uniqueçº¦æŸçš„å­—æ®µä¼šè‡ªåŠ¨æ·»åŠ **ç´¢å¼•

## View: è§†å›¾

from different perspetive to see the data
ç«™åœ¨ä¸åŒè§’åº¦çœ‹å¾…æ•°æ®ï¼ˆåŒä¸€å¼ è¡¨çš„ï¼‰

ğŸ¬ **å¯¹è§†å›¾è¿›è¡Œå¢åˆ æ”¹æŸ¥ä¼šå½±å“åˆ°åŸè¡¨æ•°æ®**if do crud on view, it will change the original data

- é€šè¿‡è§†å›¾å½±å“æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥æ“ä½œåŸè¡¨

### åˆ›å»º & åˆ é™¤è§†å›¾

åˆ›å»ºè§†å›¾

- `create view <view_name> as <DQL>;`
  - only **DQL support** view creation, but we can do **crud operations on view**

åˆ é™¤è§†å›¾

- `drop view <view_name>;`

### é¢å‘è§†å›¾æ“ä½œ

**select** the view

- `select ... from <view_name>;`

**update the view(crud**,to change the original table indirectly)

- `update <view_name> set field=...,field=... where ...;`

**delete the data from view(crud**, to delete the original table data indirectly)

- `delete from <view_name> where...`

### è§†å›¾ä½œç”¨ï¼ˆseldom usedï¼‰

![](/static/2020-09-17-13-52-26.png)

- **è§†å›¾å¯ä»¥éšè—è¡¨çš„å®ç°ç»†èŠ‚**ã€‚<font color="red">ä¿å¯†çº§åˆ«è¾ƒé«˜çš„ç³»ç»Ÿï¼Œæ•°æ®åº“åªå¯¹å¤–æä¾›ç›¸å…³è§†å›¾</font>ï¼Œjavaç¨‹åºå‘˜åªå¯¹è§†å›¾å¯¹è±¡è¿›è¡ŒCRUDï¼ˆview can shield the details of the table, and for the high-level confidentiality of the system, db only provides the view to the external access & java developers only operates CRUD on viewsï¼‰
  - **å¯¹å¤–åªçŸ¥é“æœ‰åˆ«åçš„å­—æ®µï¼Œä¸çŸ¥é“åŸè¡¨çš„åŸå­—æ®µå**(external only see the renaming of the fields, but cannot know the original(actual) name of that)