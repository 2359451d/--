# Content

* [Content](#content)
* [意义](#意义)
* [一级缓存](#一级缓存)
* [二级缓存](#二级缓存)
* [缓存相关属性](#缓存相关属性)
* [缓存有关设置](#缓存有关设置)
* [缓存查询顺序](#缓存查询顺序)
* [缓存原理](#缓存原理)
* [第三方缓存](#第三方缓存)

# 意义

暂存的一些数据，加快系统查询速度

![](/static/2021-08-06-23-23-04.png)

* map，能保存查询出的一些数据
* 一级
  * 线程级别的缓存，本地缓存，sqlsession级别的缓存
* 二级
  * 全局范围的缓存，除过当前线程，sqlsession能用外其他也可以

# 一级缓存

默认存在，只要之前查询的数据，就会保存在一个缓存map中

![](/static/2021-08-06-23-38-51.png)
![](/static/2021-08-06-23-39-12.png)

失效情况

* 不同sqlsession使用不同一级缓存
* 同一个方法不同参数，由于之前没查过，可能还是要发新sql
* sqlsession中进行任何CUD操作，都会清空缓存
* 手动清空缓存
  * `openSession.clearCache()`

# 二级缓存

![](/static/2021-08-06-23-50-24.png)

全局配置中开启二级缓存
![](/static/2021-08-06-23-53-32.png)

需要使用二级缓存的映射文件处配置`cache`标签，让其使用二级缓存
![](/static/2021-08-06-23-54-25.png)

# 缓存相关属性

![](/static/2021-08-06-23-57-49.png)

# 缓存有关设置

![](/static/2021-08-07-00-10-41.png)

# 缓存查询顺序

不会出现一级缓存 & 二级缓存中有相同数据

* 二级缓存中，一级缓存关闭了才有
* 一级缓存中，二级缓存中没有数据就会看一级缓存。再没有就去查db，然后放入一级缓存

# 缓存原理

![](/static/2021-08-07-00-09-33.png)

顺序 ： 2->1->db

# 第三方缓存

![](/static/2021-08-07-13-51-03.png)
![](/static/2021-08-07-13-52-21.png)

1.导包

2.配置文件

![](/static/2021-08-07-13-55-22.png)

* 原DAO使用mybatis默认缓存

![](/static/2021-08-07-13-56-13.png)

* 已经实现了Cache接口，直接引用

3.mapper.xml映射文件中配置使用自定义的缓存

* `cache type=""`
* `cache-ref namespace=""`

