# TLS局限性 & 特性

![](/static/2021-02-22-16-33-03.png)

# 连接元数据：Connection Metadata

TLS建立于TCP连接之上

* 一旦TCP连接建立，使用TLS协商加密信息
* **然而TCP元数据会暴露**
  * **TCP/IP头**中信息未加密&认证 the information in the TCP and IP packet headers (the “metadata”) is not encrypted or authenticated
* 只有TCP段数据加密

# 传输中数据：data in transit/at rest

TLS等安全通信协议的性质是，它们保护端点之间传输中的数据，但不保护端点内存储的数据

* 例如，一个消息应用程序可能会使用TLS来保护用户和消息服务器之间的通信，
  * 但依靠消息服务器运营商在服务器上安全地存储消息。
  * 使用的一些服务或应用程序，尝试找出它是否使用TLS或其他安全协议来保护其通信（HTTPS，即HTTP over TLS是保护通信的常用选择）

# TLS

包含握手 & 记录协议

* 握手协议
  * 用于协商加密密钥 & 算法
* 记录协议
  * 用于交换加密数据块

TLS握手协议僵化

* TLS中间盒复杂化
  * TLSv1.3握手协议需要假装成v1.2握手协议
  * 真正使用的协议版本包括在扩展部分 extension
    * 由中间盒不能正确实现TLS版本协商导致的协议僵化造成

记录协议

* 当TLS握手协议协商好加密密钥和其他安全参数后 TLS记录协议就会被用来交换实际数据
* 当使用没有TLS的TCP时，TCP连接不会保留消息边界。
  * 也就是说，如果在TCP流上发送两条消息，每条消息由100个字节组成，那么所有的200个字节将按照发送的顺序出现在接收方，但它们不一定会作为两个100个字节的块出现
* 当使用TLS时，记录层会确保消息的边界被保留，
  * 所以如果一个TLS发送者将两个100字节的消息写入通过TCP运行的TLS连接中，
    * TLS会确保它们作为两个100字节的消息出现在接收方

# QUIC

QUIC传输协议的一个主要好处是它可以将初始连接建立握手和TLS握手重叠，将连接建立的延迟降低到一个往返时间。

* 其目的是取代TLS和TCP
* 在互联网中，这意味着它应该以与 TCP 相同的方式在 IP 上运行
  * **QUIC 没有这样做。相反，它运行在UDP之上**，因为经验表明，很难部署直接在IP上运行的新传输协议，因为防火墙往往会阻止使用未知协议的流量。
    * **这被称为协议僵化，是TLS握手问题的更严重版本**

